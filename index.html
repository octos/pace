<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Run Time Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#f7f7f7;color:#000;line-height:1.2;}
    .container{max-width:100%;padding:8px;margin:0 auto;position:relative;}
    .controls{
        text-align:center;margin:8px 0;padding:6px;background:#fff;border-radius:6px;
        box-shadow:0 1px 4px rgba(0,0,0,.1);font-size:0.9rem;
        position:sticky;top:0;z-index:20;background:#fff;
    }
    .controls label{font-weight:600;margin-right:4px;}
    .controls input{padding:6px 8px;font-size:1rem;width:90px;text-align:center;border:1px solid #ccc;border-radius:4px;}
    table{width:100%;border-collapse:collapse;margin-top:8px;background:#fff;font-size:0.82rem;box-shadow:0 1px 4px rgba(0,0,0,.1);}
    th,td{border:1px solid #ddd;padding:3px 5px;text-align:center;vertical-align:middle;line-height:1.1;}
    th{background:#444;color:#fff;font-size:0.75rem;position:sticky;z-index:10;}
    .header-row-1 th{top:0;}
    .header-row-2 th{top:44px;}
    tr:nth-child(even):not(.fine){background:#f9f9f9;}
    
    /* Column background colors */
    .green{background:#e8f5e9 !important;}
    .yellow{background:#fffde7 !important;}
    .red{background:#fcebea !important;}

    .pace{
        font-weight:bold;background:#ecf0f1;white-space:nowrap;font-size:0.78rem;
        cursor:pointer;transition:background 0.2s;
    }
    .pace:hover{background:#d0e6ec;}
    .fine .pace{
        background:#e8f4f8;font-weight:normal;font-size:0.74rem;padding-left:12px;
    }
    .duration{color:#7f8c8d;font-size:0.78rem;}
    .finish{font-weight:bold;font-size:0.82rem;}
    .green .finish{color:#27ae60;}
    .yellow .finish{color:#f39c12;}
    .red .finish{color:#c0392b;}
    .remaining{
        font-size:0.7rem;color:#555;font-style:italic;display:block;margin-top:1px;
    }
    .remaining.now{color:#e74c3c !important;font-weight:bold;}
    .remaining.urgent{color:#e91e63 !important;}

    .subheader{font-size:0.65rem;color:#ddd;display:block;font-weight:normal;}
    .footer{margin-top:12px;text-align:center;font-size:0.75rem;color:#7f8c8d;}
    td.duration, td.finish{font-family:consolas,monospace;}
    .fine{display:none;}
    .fine.show{display:table-row;}
    
    @media (max-width:480px){
        th,td{padding:2px 3px;font-size:0.75rem;line-height:1.1;}
        .pace{font-size:0.73rem;}
        .fine .pace{font-size:0.70rem;}
        .duration,.finish{font-size:0.75rem;}
        .remaining{font-size:0.65rem;}
        .controls input{width:80px;font-size:0.95rem;}
        .header-row-2 th{top:40px;}
    }
</style>
</head>
<body>
<div class="container">
    <div class="controls">
        <label for="startTime">Start time:</label>
        <input type="text" id="startTime" placeholder="09:30">
        <small style="margin-left:4px;color:#7f8c8d;">recalculates every 30s</small>
    </div>

    <table id="resultsTable">
        <thead>
            <tr class="header-row-1">
                <th rowspan="2">Pace<br><span class="subheader">min/mi</span></th>
                <th colspan="2">Green 4.11</th>
                <th colspan="2">Yellow 4.52</th>
                <th colspan="2">Red 6.56</th>
            </tr>
            <tr class="header-row-2">
                <th>Duration</th><th>Finish</th>
                <th>Duration</th><th>Finish</th>
                <th>Duration</th><th>Finish</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="footer">
        Written for Ragnar AZ 2025. | <em>(Xh Ym)</em> = time left from now
    </div>
</div>

<script>
const distances = {green:4.11, yellow:4.52, red:6.56};

function paceSeconds(p){return p.min*60 + p.sec;}
function calcDurationSeconds(dist,ps){return Math.round(dist*ps);}
function formatSeconds(totalSec){
    const h=Math.floor(totalSec/3600), m=Math.floor((totalSec%3600)/60), s=totalSec%60;
    return h?`${h}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`:`${m}:${s.toString().padStart(2,'0')}`;
}
function formatRemaining(totalSec){
    if(totalSec <= 0) return '<span class="remaining now">(now)</span>';
    const h=Math.floor(totalSec/3600), m=Math.floor((totalSec%3600)/60);
    const parts=[];
    if(h) parts.push(`${h}h`);
    if(m) parts.push(`${m}m`);
    const text = `(${parts.length?parts.join(' '):'0m'})`;
    if(totalSec < 600) return `<span class="remaining urgent">${text}</span>`;
    return `<span class="remaining">${text}</span>`;
}
function formatPace(p){return `${p.min}:${p.sec.toString().padStart(2,'0')}`;}
function addMinutes(startMin,addSec){
    const totalMin=startMin+Math.floor(addSec/60);
    const h=Math.floor(totalMin/60)%24, m=totalMin%60;
    return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
}
function getCurrentMinutes(){const d=new Date();return d.getHours()*60+d.getMinutes();}
function getCurrentSeconds(){const d=new Date();return d.getHours()*3600+d.getMinutes()*60+d.getSeconds();}
function getCurrentTime(){const d=new Date();return `${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;}

/* ---------- All paces ---------- */
const allPaces = [];
for(let m=7; m<=18; m++){
    allPaces.push({min:m, sec:0, isFine:false});
    if(m < 18){
        allPaces.push({min:m, sec:20, isFine:true});
        allPaces.push({min:m, sec:40, isFine:true});
    }
}

let expandedMinute = null;

function buildRow(p, startMin, startSec, nowSec){
    const ps = paceSeconds(p);
    const gSec = calcDurationSeconds(distances.green,ps);
    const ySec = calcDurationSeconds(distances.yellow,ps);
    const rSec = calcDurationSeconds(distances.red,ps);

    const row = document.createElement('tr');
    row.dataset.min = p.min;
    row.dataset.sec = p.sec;

    const remG = formatRemaining(Math.max(0, gSec + startSec - nowSec));
    const remY = formatRemaining(Math.max(0, ySec + startSec - nowSec));
    const remR = formatRemaining(Math.max(0, rSec + startSec - nowSec));

    row.innerHTML = `
        <td class="pace">${formatPace(p)}</td>
        <td class="green duration">${formatSeconds(gSec)}</td>
        <td class="green finish">${addMinutes(startMin,gSec)}<br>${remG}</td>
        <td class="yellow duration">${formatSeconds(ySec)}</td>
        <td class="yellow finish">${addMinutes(startMin,ySec)}<br>${remY}</td>
        <td class="red duration">${formatSeconds(rSec)}</td>
        <td class="red finish">${addMinutes(startMin,rSec)}<br>${remR}</td>
    `;

    if(p.isFine){
        row.className = 'fine';
    } else {
        const paceCell = row.querySelector('.pace');
        paceCell.style.cursor = 'pointer';
        paceCell.title = 'Click to expand :20 and :40';
        paceCell.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleExpand(p.min);
        });
    }

    return row;
}

function toggleExpand(minute){
    expandedMinute = (expandedMinute === minute) ? null : minute;
    updateTable();
}

function updateTable(){
    const tbody = document.querySelector('#resultsTable tbody');
    tbody.innerHTML = '';

    let input = document.getElementById('startTime').value.trim();
    const startStr = input || getCurrentTime();
    let startMin = 0;
    if(/^\d{1,2}:\d{2}$/.test(startStr)){
        const [h,m] = startStr.split(':').map(Number);
        if(h>=0&&h<24&&m>=0&&m<60) startMin = h*60 + m;
        else startMin = getCurrentMinutes();
    } else startMin = getCurrentMinutes();
    if(!input) document.getElementById('startTime').value = startStr;

    const nowSec = getCurrentSeconds();
    const startSec = startMin * 60;

    let currentMin = null;
    let fine20 = null, fine40 = null;

    allPaces.forEach(p => {
        if(p.isFine){
            if(p.sec === 20) fine20 = buildRow(p, startMin, startSec, nowSec);
            if(p.sec === 40) fine40 = buildRow(p, startMin, startSec, nowSec);
        } else {
            if(currentMin !== null && expandedMinute === currentMin){
                if(fine20) { fine20.classList.add('show'); tbody.appendChild(fine20); }
                if(fine40) { fine40.classList.add('show'); tbody.appendChild(fine40); }
            }
            currentMin = p.min;
            fine20 = buildRow({min:p.min, sec:20, isFine:true}, startMin, startSec, nowSec);
            fine40 = buildRow({min:p.min, sec:40, isFine:true}, startMin, startSec, nowSec);
            tbody.appendChild(buildRow(p, startMin, startSec, nowSec));
        }
    });
}

window.onload = () => {
    const inp = document.getElementById('startTime');
    inp.value = getCurrentTime();
    updateTable();
    inp.addEventListener('input', updateTable);
    setInterval(updateTable, 30000);
};
</script>
</body>
</html>
